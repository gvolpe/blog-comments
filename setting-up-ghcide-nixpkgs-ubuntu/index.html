<!DOCTYPE html> <html lang="en-uk"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> Setting up Ghcide in Ubuntu with Nixpkgs &bull; gvolpe's blog </title> <meta name="description" content="If you use Ubuntu or any other Linux distribution (AKA distro) together with Nixpkgs, you might have noticed things don’t play so well together. Nixpkgs has ..."> <link rel="stylesheet" href="/blog/css/main.css"> <link rel="canonical" href="https://gvolpe.github.io/blog/setting-up-ghcide-nixpkgs-ubuntu/"> <link rel="alternate" type="application/rss+xml" title="gvolpe's blog" href="https://gvolpe.github.io/blog/feed.xml" /> <script defer type="text/javascript" src="https://api.pirsch.io/pirsch.js" id="pirschjs" data-code="db2twsz97grcqToSsEMhvcQXm8rLaFmQ"> </script> </head> <body class="single"> <main class="main"> <header class="header"> <div class="overlay"> <div class="container"> <h1 class="title"> <a href="/blog/">gvolpe's blog</a> </h1> <nav class="navbar"> <a href="#" class="menu-icon"> <span></span> <span></span> <span></span> </a> <ul class="nav"> <li><a href="https://gvolpe.com" target="_blank">Website</a></li> </ul> </nav> </div> </div> </header> <article class="post container card"> <header class="post-header"> <h1 class="post-title">Setting up Ghcide in Ubuntu with Nixpkgs</h1> <span class="post-meta"> <time class="post-date" datetime="2020-03-21">Mar 21, 2020</time> <span class="post-author">by Gabriel Volpe</span> </span> </header> <div class="post-content"> <p>If you use <a href="https://ubuntu.com/">Ubuntu</a> or any other Linux distribution (AKA <em>distro</em>) together with <a href="https://nixos.org/nixpkgs/">Nixpkgs</a>, you might have noticed things don’t play so well together. Nixpkgs has been mainly designed to work seamlessly in <a href="https://nixos.org/nixos/">Nix OS</a>; other distros are second class citizens.</p> <p>Quoting the <a href="https://github.com/digital-asset/ghcide">Ghcide</a> repository, it is defined as:</p> <blockquote> <p>A library for building Haskell IDE tooling</p> </blockquote> <p>It is not defined as an IDE, because it only has a subset of the features <a href="https://github.com/haskell/haskell-ide-engine">HIE (Haskell IDE Engine)</a> has. However, the good news is that the HIE and Ghcide teams are joining forces to create <a href="https://neilmitchell.blogspot.com/2020/01/one-haskell-ide-to-rule-them-all.html">One Haskell IDE to rule them all</a>!</p> <p>For what it’s worth, I’ve been using HIE for a while together with my favorite text editor, <a href="https://neovim.io/">NeoVim</a>. It’s got a lot of cool features but it’s been quite buggy, in my experience.</p> <p>Ghcide only offers a few features that work flawlessly, and my experience has been great so far. Though, setting it up to work properly in NeoVim on Ubuntu when all your software has been installed using Nixpkgs hasn’t been easy at all.</p> <iframe width="680" height="350" src="https://www.youtube.com/embed/6bP_cpJkzdg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe> <p>This is the reason why I am writing this blog post. Aim at those who use Nixpkgs like me, in a different distro other than NixOS.</p> <h2 id="installing-ghcide">Installing Ghcide</h2> <p>If you go to the main Ghcide repository, you’ll find instructions on how to install it. For those using Nix, it is officially recommended using <a href="https://github.com/hercules-ci/ghcide-nix">Ghcide-Nix</a>.</p> <p>If everything went well, you will find its binary in your Nix profile.</p> <div class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="nf">λ</span> <span class="o">~</span> <span class="n">which</span> <span class="n">ghcide</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">gvolpe</span><span class="o">/.</span><span class="n">nix</span><span class="o">-</span><span class="n">profile</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ghcide</span></code></pre></div> <p>To verify Ghcide works, go to any Haskell project or standalone files, and run <code>ghcide</code>.</p> <div class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="nf">λ</span> <span class="o">~</span> <span class="n">ghcide</span>
<span class="nf">ghcide</span> <span class="n">version</span><span class="kt">:</span> <span class="mf">0.1</span><span class="o">.</span><span class="mi">0</span> <span class="p">(</span><span class="kt">GHC:</span> <span class="mf">8.6</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span> <span class="p">(</span><span class="kt">PATH:</span> <span class="o">/</span><span class="n">nix</span><span class="o">/</span><span class="n">store</span><span class="o">/</span><span class="mi">02</span><span class="n">wcifqr53wjs1m5vn670b1avfy071az</span><span class="o">-</span><span class="n">ghcide</span><span class="o">-</span><span class="mf">0.1</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="n">exe</span><span class="o">-</span><span class="n">ghcide</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ghcide</span><span class="p">)</span>
<span class="kt">Ghcide</span> <span class="n">setup</span> <span class="n">tester</span> <span class="kr">in</span> <span class="o">/</span><span class="n">workspace</span><span class="o">/</span><span class="n">oss</span><span class="o">/</span><span class="n">types</span><span class="o">-</span><span class="n">matter</span><span class="o">.</span>
<span class="kt">Report</span> <span class="n">bugs</span> <span class="n">at</span> <span class="n">https</span><span class="kt">://</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">digital</span><span class="o">-</span><span class="n">asset</span><span class="o">/</span><span class="n">ghcide</span><span class="o">/</span><span class="n">issues</span>

<span class="kt">Step</span> <span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="kt">:</span> <span class="kt">Finding</span> <span class="n">files</span> <span class="n">to</span> <span class="n">test</span> <span class="kr">in</span> <span class="o">/</span><span class="n">workspace</span><span class="o">/</span><span class="n">oss</span><span class="o">/</span><span class="n">types</span><span class="o">-</span><span class="n">matter</span>
<span class="kt">Found</span> <span class="mi">6</span> <span class="n">files</span>

<span class="kt">Step</span> <span class="mi">2</span><span class="o">/</span><span class="mi">6</span><span class="kt">:</span> <span class="kt">Looking</span> <span class="n">for</span> <span class="n">hie</span><span class="o">.</span><span class="n">yaml</span> <span class="n">files</span> <span class="n">that</span> <span class="n">control</span> <span class="n">setup</span>
<span class="kt">Found</span> <span class="mi">1</span> <span class="n">cradle</span>

<span class="kt">Step</span> <span class="mi">3</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="kt">Cradle</span> <span class="mi">1</span><span class="o">/</span><span class="mi">1</span><span class="kt">:</span> <span class="kt">Loading</span> <span class="o">/</span><span class="n">workspace</span><span class="o">/</span><span class="n">oss</span><span class="o">/</span><span class="n">types</span><span class="o">-</span><span class="n">matter</span><span class="o">/</span><span class="n">hie</span><span class="o">.</span><span class="n">yaml</span>

<span class="kt">Step</span> <span class="mi">4</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="kt">Cradle</span> <span class="mi">1</span><span class="o">/</span><span class="mi">1</span><span class="kt">:</span> <span class="kt">Loading</span> <span class="kt">GHC</span> <span class="kt">Session</span>
<span class="o">&gt;</span> <span class="kt">Warning:</span> <span class="kt">The</span> <span class="n">package</span> <span class="n">list</span> <span class="n">for</span> <span class="n">&#39;hackage</span><span class="o">.</span><span class="n">haskell</span><span class="o">.</span><span class="n">org&#39;</span> <span class="n">is</span> <span class="mi">15</span> <span class="n">days</span> <span class="n">old</span><span class="o">.</span>
<span class="o">&gt;</span> <span class="kt">Run</span> <span class="n">&#39;cabal</span> <span class="n">update&#39;</span> <span class="n">to</span> <span class="n">get</span> <span class="n">the</span> <span class="n">latest</span> <span class="n">list</span> <span class="kr">of</span> <span class="n">available</span> <span class="n">packages</span><span class="o">.</span>
<span class="o">&gt;</span> <span class="kt">Resolving</span> <span class="n">dependencies</span><span class="o">...</span>
<span class="o">&gt;</span> <span class="kt">Build</span> <span class="n">profile</span><span class="kt">:</span> <span class="o">-</span><span class="n">w</span> <span class="n">ghc</span><span class="o">-</span><span class="mf">8.6</span><span class="o">.</span><span class="mi">5</span> <span class="o">-</span><span class="kt">O1</span>
<span class="o">&gt;</span> <span class="kt">In</span> <span class="n">order</span><span class="p">,</span> <span class="n">the</span> <span class="n">following</span> <span class="n">will</span> <span class="n">be</span> <span class="n">built</span> <span class="p">(</span><span class="n">use</span> <span class="o">-</span><span class="n">v</span> <span class="n">for</span> <span class="n">more</span> <span class="n">details</span><span class="p">)</span><span class="kt">:</span>
<span class="o">&gt;</span>  <span class="o">-</span> <span class="n">types</span><span class="o">-</span><span class="n">matter</span><span class="o">-</span><span class="mf">0.1</span><span class="o">.</span><span class="mf">0.0</span> <span class="p">(</span><span class="n">lib</span><span class="p">)</span> <span class="p">(</span><span class="n">configuration</span> <span class="n">changed</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="kt">Configuring</span> <span class="n">library</span> <span class="n">for</span> <span class="n">types</span><span class="o">-</span><span class="n">matter</span><span class="o">-</span><span class="mf">0.1</span><span class="o">.</span><span class="mf">0.0</span><span class="o">..</span>
<span class="o">&gt;</span> <span class="kt">Preprocessing</span> <span class="n">library</span> <span class="n">for</span> <span class="n">types</span><span class="o">-</span><span class="n">matter</span><span class="o">-</span><span class="mf">0.1</span><span class="o">.</span><span class="mf">0.0</span><span class="o">..</span>
<span class="nf">ghcide</span><span class="kt">:</span> <span class="o">&lt;</span><span class="n">command</span> <span class="n">line</span><span class="o">&gt;:</span> <span class="n">cannot</span> <span class="n">satisfy</span> <span class="o">-</span><span class="n">package</span><span class="o">-</span><span class="n">id</span> <span class="n">refined</span><span class="o">-</span><span class="mf">0.4</span><span class="o">.</span><span class="mi">4</span><span class="o">-</span><span class="n">ea7ce6a6d7ef3587351a3b3bdc4140a3a7bcd0f526627e28a7d5d456e39e9aa9</span><span class="kt">:</span>
    <span class="n">refined</span><span class="o">-</span><span class="mf">0.4</span><span class="o">.</span><span class="mi">4</span><span class="o">-</span><span class="n">ea7ce6a6d7ef3587351a3b3bdc4140a3a7bcd0f526627e28a7d5d456e39e9aa9</span> <span class="n">is</span> <span class="n">unusable</span> <span class="n">due</span> <span class="n">to</span> <span class="n">missing</span> <span class="n">dependencies</span><span class="kt">:</span>
      <span class="kt">QuickCheck</span><span class="o">-</span><span class="mf">2.13</span><span class="o">.</span><span class="mi">2</span><span class="o">-</span><span class="mi">8</span><span class="n">aa3fcd8ac86c93ae5db4035083dd975e5b8f88ea826f8604a5748a04c7798bd</span> <span class="n">aeson</span><span class="o">-</span><span class="mf">1.4</span><span class="o">.</span><span class="mf">6.0</span><span class="o">-</span><span class="mi">3</span><span class="n">a4c86def05154b3acabc0a30d0acd96d235de9d3fd7ba28330e785107e8f5da</span> <span class="n">exceptions</span><span class="o">-</span><span class="mf">0.10</span><span class="o">.</span><span class="mi">4</span><span class="o">-</span><span class="mf">2e686</span><span class="n">fdff7a6bdbd62e24641169087c094e991de8ab3f6381a859306fd258e32</span> <span class="n">mtl</span><span class="o">-</span><span class="mf">2.2</span><span class="o">.</span><span class="mi">2</span> <span class="n">prettyprinter</span><span class="o">-</span><span class="mf">1.3</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="mi">08</span><span class="n">f8b1f2cf2a49ae7d9056e4ed9fbb3f75b812f789dbb30ab5e82b53b6cc42c8</span> <span class="n">transformers</span><span class="o">-</span><span class="mf">0.5</span><span class="o">.</span><span class="mf">6.2</span>
    <span class="p">(</span><span class="n">use</span> <span class="o">-</span><span class="n">v</span> <span class="n">for</span> <span class="n">more</span> <span class="n">information</span><span class="p">)</span></code></pre></div> <p>Yes, you may get a similar output. So let’s make it clear.</p> <blockquote> <p>All software installed by Nix works better within a Nix Shell.</p> </blockquote> <p>You hear me. If you want this to work, make sure to you have a Nix Shell set up for your project and even run your text editor within a Nix Shell. <em>This is the only sane way</em>.</p> <h3 id="configuring-nix-shell">Configuring Nix Shell</h3> <p>Nix shell is amazing! It creates an environment where all the necessary software is installed. Once you’re done, you leave the shell and come back to your regular terminal. This way we avoid polluting our global environment, i.e. installing unnecessary global software such as Ruby, Node.js, etc.</p> <p>Now, there are many ways to properly set up a Nix Shell for a Haskell project. I personally like to use <a href="https://github.com/NixOS/cabal2nix">Cabal2Nix</a> to Nixify my <a href="https://github.com/haskell/cabal">Cabal</a> projects. It basically creates a derivation with all the Haskell packages we need. Here’s an example:</p> <div class="highlight"><pre><code class="language-nix" data-lang="nix"><span class="p">{</span> mkDerivation<span class="p">,</span> aeson<span class="p">,</span> async<span class="p">,</span> base<span class="p">,</span> bytestring<span class="p">,</span> co-log-core
<span class="p">,</span> containers<span class="p">,</span> dhall<span class="p">,</span> exceptions<span class="p">,</span> hedis<span class="p">,</span> postgresql-simple
<span class="p">,</span> raw-strings-qq<span class="p">,</span> refined<span class="p">,</span> servant<span class="p">,</span> servant-server<span class="p">,</span> stdenv
<span class="p">,</span> template-haskell<span class="p">,</span> text<span class="p">,</span> uuid<span class="p">,</span> wai<span class="p">,</span> wai-cors<span class="p">,</span> warp<span class="p">,</span> wreq
<span class="p">}:</span>
mkDerivation <span class="p">{</span>
  <span class="ss">pname =</span> <span class="s2">&quot;shopping-cart&quot;</span><span class="p">;</span>
  <span class="ss">version =</span> <span class="s2">&quot;0.1.0.0&quot;</span><span class="p">;</span>
  <span class="ss">src =</span> <span class="o">.</span><span class="l">/.</span><span class="p">;</span>
  <span class="ss">isLibrary =</span> <span class="no">true</span><span class="p">;</span>
  <span class="ss">isExecutable =</span> <span class="no">true</span><span class="p">;</span>
  <span class="ss">libraryHaskellDepends =</span> <span class="p">[</span>
    aeson async base bytestring co-log-core containers dhall exceptions
    hedis postgresql-simple raw-strings-qq refined servant
    servant-server template-haskell text uuid wai wai-cors warp wreq
  <span class="p">];</span>
  <span class="ss">executableHaskellDepends =</span> <span class="p">[</span> base <span class="p">];</span>
  <span class="ss">description =</span> <span class="s2">&quot;The Shopping Cart developed in PFP Scala for Haskell&quot;</span><span class="p">;</span>
  <span class="ss">license =</span> stdenv<span class="o">.</span>lib<span class="o">.</span>licenses<span class="o">.</span>asl20<span class="p">;</span>
<span class="p">}</span></code></pre></div> <p>This derivation belongs in the <code>shopping-cart.nix</code> file, and it was created from a <code>shopping-cart.cabal</code> file as follows:</p> <div class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="nf">cabal2nix</span> <span class="o">.</span> <span class="o">&gt;</span> <span class="n">shopping</span><span class="o">-</span><span class="n">cart</span><span class="o">.</span><span class="n">nix</span></code></pre></div> <p>In my current set up, I have three other Nix files that are needed in order to properly run this project within a Nix Shell: <code>default.nix</code>, <code>release.nix</code>, and <code>shell.nix</code>.</p> <p>This is the content of <code>default.nix</code>, which indicates what GHC version we need:</p> <div class="highlight"><pre><code class="language-nix" data-lang="nix"><span class="p">{</span> nixpkgs <span class="o">?</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{},</span> compiler <span class="o">?</span> <span class="s2">&quot;ghc865&quot;</span> <span class="p">}:</span>
nixpkgs<span class="o">.</span>pkgs<span class="o">.</span>haskell<span class="o">.</span>packages<span class="o">.</span><span class="err">$</span><span class="p">{</span>compiler<span class="p">}</span><span class="o">.</span>callPackage <span class="o">.</span><span class="l">/shopping-cart.nix</span> <span class="p">{</span> <span class="p">}</span></code></pre></div> <p>Next is the content of <code>release.nix</code>, which only refers to <code>default.nix</code>:</p> <div class="highlight"><pre><code class="language-nix" data-lang="nix"><span class="k">let</span>
  <span class="ss">pkgs =</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{</span> <span class="p">};</span>
<span class="k">in</span>
  pkgs<span class="o">.</span>haskellPackages<span class="o">.</span>callPackage <span class="o">.</span><span class="l">/default.nix</span> <span class="p">{</span> <span class="p">}</span></code></pre></div> <p>Finally, the most important one, <code>shell.nix</code>:</p> <div class="highlight"><pre><code class="language-nix" data-lang="nix"><span class="p">{</span> nixpkgs <span class="o">?</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{}</span> <span class="p">}:</span>
<span class="k">let</span>
  <span class="k">inherit</span> <span class="p">(</span>nixpkgs<span class="p">)</span> pkgs<span class="p">;</span>
  <span class="k">inherit</span> <span class="p">(</span>pkgs<span class="p">)</span> haskellPackages<span class="p">;</span>

  <span class="ss">project =</span> <span class="nb">import</span> <span class="o">.</span><span class="l">/release.nix</span><span class="p">;</span>
<span class="k">in</span>
pkgs<span class="o">.</span>stdenv<span class="o">.</span>mkDerivation <span class="p">{</span>
  <span class="ss">name =</span> <span class="s2">&quot;shell&quot;</span><span class="p">;</span>
  <span class="ss">buildInputs =</span> project<span class="o">.</span>env<span class="o">.</span>nativeBuildInputs <span class="o">++</span> <span class="p">[</span>
    haskellPackages<span class="o">.</span>cabal-install
    haskellPackages<span class="o">.</span>hlint
  <span class="p">];</span>
  <span class="ss">shellHook =</span> <span class="s1">&#39;&#39;</span>
<span class="s1">    export NIX_GHC=&quot;$(which ghc)&quot;</span>
<span class="s1">    export NIX_GHCPKG=&quot;$(which ghc-pkg)&quot;</span>
<span class="s1">    export NIX_GHC_DOCDIR=&quot;$NIX_GHC/../../share/doc/ghc/html&quot;</span>
<span class="s1">    export NIX_GHC_LIBDIR=&quot;$(ghc --print-libdir)&quot;</span>
<span class="s1">  &#39;&#39;</span><span class="p">;</span>
<span class="p">}</span></code></pre></div> <p>The important part here is our <code>shellHook</code>, which exports a few environment variables needed to get GHC properly detected by Nixpkgs within a Nix Shell.</p> <p>Furthermore, these Nix files could probably be simplified into two files or maybe a single one but, to be honest, I haven’t bothered in trying to do so. Nix is amazing when it works but, when it doesn’t, it’s a huge pain to find out what’s going on.</p> <p>You can find all these Nix files in this <a href="https://github.com/gvolpe/shopping-cart-haskell">Github repository</a>.</p> <h2 id="troubleshooting">Troubleshooting</h2> <p>There could be a lot of different things going wrong. We have seen a first common error above, but there could be a few others. Find below a summary of common issues.</p> <h3 id="error-1">Error #1</h3> <p>The following error is one of the most common ones:</p> <div class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="nf">cannot</span> <span class="n">satisfy</span> <span class="o">-</span><span class="n">package</span><span class="o">-</span><span class="n">id</span> <span class="n">ghc</span><span class="o">-</span><span class="mf">8.6</span><span class="o">.</span><span class="mi">5</span></code></pre></div> <p>I have reported <a href="https://github.com/digital-asset/ghcide/issues/439">this issue</a>. This seems to happen because the GHC version detected by Ghcide is not the same it is expected by the Cabal project. Fortunately, this is fixed by the export of the environment variables defined in our <code>shellHook</code>.</p> <p>Notice that the error message might show a different package, such as <code>aeson</code>, not only <code>ghc</code>. The fix seems to be the same, though.</p> <h3 id="error-2">Error #2</h3> <p>You may get a lot of the following errors as well:</p> <div class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kt">Step</span> <span class="mi">6</span><span class="o">/</span><span class="mi">6</span><span class="kt">:</span> <span class="kt">Type</span> <span class="n">checking</span> <span class="n">the</span> <span class="n">files</span>
<span class="kt">File:</span>     <span class="o">/</span><span class="n">workspace</span><span class="o">/</span><span class="n">oss</span><span class="o">/</span><span class="n">shopping</span><span class="o">-</span><span class="n">cart</span><span class="o">-</span><span class="n">haskell</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="kt">Main</span><span class="o">.</span><span class="n">hs</span>
<span class="kt">Hidden:</span>   <span class="n">no</span>
<span class="kt">Range:</span>    <span class="mi">5</span><span class="kt">:</span><span class="mi">17</span><span class="o">-</span><span class="mi">5</span><span class="kt">:</span><span class="mi">28</span>
<span class="kt">Source:</span>   <span class="n">not</span> <span class="n">found</span>
<span class="kt">Severity:</span> <span class="kt">DsError</span>
<span class="kt">Message:</span>
  <span class="kt">Could</span> <span class="n">not</span> <span class="n">find</span> <span class="kr">module</span> <span class="err">‘</span><span class="nn">Http.Server</span><span class="err">’</span>
  <span class="kt">It</span> <span class="n">is</span> <span class="n">not</span> <span class="n">a</span> <span class="kr">module</span> <span class="err">in</span> <span class="err">the</span> <span class="err">current</span> <span class="err">program,</span> <span class="err">or</span> <span class="err">in</span> <span class="err">any</span> <span class="err">known</span> <span class="err">package.</span></code></pre></div> <p>This is normally fixed by creating a specific <code>hie.yaml</code> file, indicating <a href="https://github.com/mpickering/hie-bios">hie-bios</a> how to read our project. Here’s the one defined in the Shopping Cart project:</p> <div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">cradle</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span><span class="nv">cabal</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span><span class="nv">component</span><span class="p-Indicator">:</span> <span class="s">&quot;lib:shopping-cart&quot;</span><span class="p-Indicator">}}</span></code></pre></div> <p>You will still get the same error with your <code>Setup.hs</code> file, defined by Cabal:</p> <div class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kt">Message:</span>
  <span class="kt">Could</span> <span class="n">not</span> <span class="n">load</span> <span class="kr">module</span> <span class="err">‘</span><span class="nn">Distribution.Simple</span><span class="err">’</span>
  <span class="kt">It</span> <span class="n">is</span> <span class="n">a</span> <span class="n">member</span> <span class="kr">of</span> <span class="n">the</span> <span class="n">hidden</span> <span class="n">package</span> <span class="err">‘</span><span class="kt">Cabal</span><span class="o">-</span><span class="mf">2.4</span><span class="o">.</span><span class="mf">0.1</span><span class="err">’</span><span class="o">.</span>
  <span class="kt">Perhaps</span> <span class="n">you</span> <span class="n">need</span> <span class="n">to</span> <span class="n">add</span> <span class="err">‘</span><span class="kt">Cabal</span><span class="err">’</span> <span class="n">to</span> <span class="n">the</span> <span class="n">build</span><span class="o">-</span><span class="n">depends</span> <span class="kr">in</span> <span class="n">your</span> <span class="o">.</span><span class="n">cabal</span> <span class="n">file</span><span class="o">.</span>
<span class="kt">Files</span> <span class="n">that</span> <span class="n">failed</span><span class="kt">:</span>
 <span class="o">*</span> <span class="o">/</span><span class="n">workspace</span><span class="o">/</span><span class="n">oss</span><span class="o">/</span><span class="n">shopping</span><span class="o">-</span><span class="n">cart</span><span class="o">-</span><span class="n">haskell</span><span class="o">/</span><span class="kt">Setup</span><span class="o">.</span><span class="n">hs</span></code></pre></div> <p>However, it doesn’t matter. Ghcide will still work in our project; this is not an issue.</p> <h3 id="error-3">Error #3</h3> <p>The following error is somewhat a nasty one:</p> <div class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kt">Error</span> <span class="n">ghcide</span><span class="kt">:</span> <span class="o">&lt;</span><span class="n">command</span> <span class="n">line</span><span class="o">&gt;:</span> <span class="n">can&#39;t</span> <span class="n">load</span> <span class="o">.</span><span class="n">so</span><span class="o">/.</span><span class="kt">DLL</span></code></pre></div> <p>If you stumble upon this one, make sure to update to the latest version. I had this error, which is reported <a href="https://github.com/digital-asset/ghcide/issues/404">here</a>, and got it fixed after updating Ghcide.</p> <h2 id="bonus-track">Bonus Track</h2> <p>As I have got used to having a linter and a formatter integrated in NeoVim when using HIE, I kind of miss these features, which are probably going to land in the future Haskell IDE as plugins.</p> <p>So I came up with a few (temporary) commands to get <a href="https://github.com/ndmitchell/hlint">HLint</a> and <a href="https://github.com/lspitzner/brittany/">Brittany</a> integrated in NeoVim.</p> <div class="highlight"><pre><code class="language-vim" data-lang="vim"><span class="nb">nnoremap</span> <span class="p">&lt;</span>leader<span class="p">&gt;</span>af :<span class="k">r</span> <span class="p">!</span>brittany <span class="p">--</span><span class="nb">write</span><span class="p">-</span><span class="k">mode</span><span class="p">=</span>inplace %:<span class="k">p</span><span class="p">&lt;</span>CR<span class="p">&gt;</span>
<span class="nb">nnoremap</span> <span class="p">&lt;</span>leader<span class="p">&gt;</span><span class="k">al</span> :AsyncRun hlint %:<span class="k">p</span><span class="p">&lt;</span>CR<span class="p">&gt;</span></code></pre></div> <p>The first one runs <code>brittany</code> on the current file in the buffer and applies its output <em>inplace</em>. The latter runs <code>hlint</code> for the current file in the buffer and it displays its result in a quickfix window. It uses the <a href="https://github.com/skywind3000/asyncrun.vim">asyncrun.vim</a> plugin.</p> <p>If you are interested in my full configuration, you can find it <a href="https://github.com/gvolpe/nix-config">here</a>.</p> <p>The future of IDEs in Haskell is only getting brighter :)</p> <p>Gabriel.</p> <aside class="share"> <span>Share this: </span> <a href="http://twitter.com/share?text=Setting up Ghcide in Ubuntu with Nixpkgs&amp;url=https://gvolpe.github.io/setting-up-ghcide-nixpkgs-ubuntu/&amp;hashtags=scala,haskell,fp&amp;via=volpegabriel87" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;"> <i class="fa fa-twitter-square"></i> </a> </aside> </div> </article> <footer class="footer t-center"> <div class="container"> <div class="social-icons"> <ul class="text-left"> <li><a href="https://twitter.com/volpegabriel87" target="_blank"><i class="fa fa-twitter"></i></a></li> </ul> </div> <small>&copy; 2024 All rights reserved. Made with <a href="http://jekyllrb.com" target="_blank">Jekyll</a> and <i class="icon icon-heart"></i></small> <small>by <a href="http://nandomoreira.me" target="_blank">nandomoreira.me</a></small> </div> </footer> </main> </body> </html></body></html>
<!--
// # Zetsu Jekyll theme - https://github.com/nandomoreriame/zetsu/
// by nandomoreira.me
-->
